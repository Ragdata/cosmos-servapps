{
  "volumes": {
    "postgres": {}
  },
  "services": {
    "{ServiceName}-postgres": {
      "hostname": "postgres",
      "container_name": "{ServiceName}-postgres",
      "image": "postgres",
      "restart": "unless-stopped",
      "healthcheck": {
        "test": [
          "CMD-SHELL",
          "pg_isready -d linkwarden -U linkwarden || exit 1"
        ],
        "interval": 5,
        "timeout": 5,
        "start_period": 30,
        "retries": 10
      },
      "environment": [
        "POSTGRES_HOST_AUTH_METHOD=trust",
        "POSTGRES_USER=linkwarden",
        "POSTGRES_PASSWORD=Linkwarden123!",
        "POSTGRES_DB=linkwarden"
      ],
      "volumes": [
        {
          "source": "postgres",
          "target": "/var/lib/postgresql",
          "type": "volume"
        }
      ],
      "network_mode": "cosmos-postgres-default",
      "labels": {
        "cosmos.stack": "postgres",
        "cosmos.stack.main": "true"
      }
    },
    "postgres-{ServiceName}-migrate": {
      "image": "linkwarden/linkwarden",
      "restart": "on-failure",
      "build": {
        "context": "https://github.com/linkwarden/linkwarden.git#main",
        "dockerfile_inline": "FROM node:20 \nWORKDIR /opt/linkwarden\nCOPY . .\nRUN yarn && \\\n  npx playwright@1.36.2 install-deps && \\\n  yarn build\nENTRYPOINT [\"yarn\"]\nCMD [\"start\"]\n"
      },
      "command": "prisma migrate deploy",
      "environment": [
        "DATABASE_URL=postgres://linkwarden:Linkwarden123!@postgres:5432/linkwarden?sslmode=disable&max_conns=20&max_idle_conns=4",
        "NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-DR5o8dX6SR5#g*@7z!k2%8#sf5S@RR6F}",
        "NEXTAUTH_URL=${NEXTAUTH_URL:-http://localhost:3000}",
        "PAGINATION_TAKE_COUNT",
        "STORAGE_FOLDER",
        "SPACES_KEY",
        "SPACES_SECRET",
        "SPACES_ENDPOINT",
        "SPACES_REGION",
        "NEXT_PUBLIC_EMAIL_PROVIDER",
        "EMAIL_FROM",
        "EMAIL_SERVER"
      ],
      "depends_on": {
        "{ServiceName}-postgres": {
          "condition": "service_healthy"
        }
      },
      "hostname": "linkwarden-migrate",
      "container_name": "postgres-linkwarden-migrate",
      "network_mode": "cosmos-postgres-default",
      "labels": {
        "cosmos.stack": "postgres"
      }
    },
    "{ServiceName}": {
      "image": "linkwarden/linkwarden",
      "restart": "unless-stopped",
      "build": {
        "context": "https://github.com/linkwarden/linkwarden.git#main",
        "dockerfile_inline": "FROM node:20 \nWORKDIR /opt/linkwarden\nCOPY . .\nRUN yarn && \\\n  npx playwright@1.36.2 install-deps && \\\n  yarn build\nENTRYPOINT [\"yarn\"]\nCMD [\"start\"]\n"
      },
      "command": "start",
      "environment": [
        "DATABASE_URL=postgres://linkwarden:Linkwarden123!@postgres:5432/linkwarden?sslmode=disable&max_conns=20&max_idle_conns=4",
        "NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-DR5o8dX6SR5#g*@7z!k2%8#sf5S@RR6F}",
        "NEXTAUTH_URL=${NEXTAUTH_URL:-http://localhost:3000}",
        "PAGINATION_TAKE_COUNT",
        "STORAGE_FOLDER",
        "SPACES_KEY",
        "SPACES_SECRET",
        "SPACES_ENDPOINT",
        "SPACES_REGION",
        "NEXT_PUBLIC_EMAIL_PROVIDER",
        "EMAIL_FROM",
        "EMAIL_SERVER"
      ],
      "depends_on": {
        "postgres-linkwarden-migrate": {
          "condition": "service_completed_successfully"
        }
      },
      "ports": [
        "3000:3000"
      ],
      "hostname": "{ServiceName}",
      "container_name": "{ServiceName}",
      "network_mode": "cosmos-postgres-default",
      "labels": {
        "cosmos.stack": "postgres"
      }
    }
  },
  "networks": {
    "cosmos-postgres-default": {}
  }
}